<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA計算機</title>
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16 24x24 32x32 48x48 64x64">
    <link rel=”apple-touch-icon” href="favicon.png" sizes=”180×180″>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
</head>
<body>
    <h1>慶應理工学部1年生が秋学期に<br>GPAを計算するためだけのサイト</h1>
    
    <div class="profile-selection-div">
        <p>第二外国語と学問を選択してください</p>
        <div class="language-radio-group">
            <input type="radio" name="language" value="1" id="chinese-language" oninput="setSubject()">
            <label class="language-label" for="chinese-language">中国語</label>
            <input type="radio" name="language" value="2" id="french-language" oninput="setSubject()">
            <label class="language-label" for="french-language">フランス語</label>
            <input type="radio" name="language" value="3" id="german-language" oninput="setSubject()">
            <label class="language-label" for="german-language">ドイツ語</label>
            <input type="radio" name="language" value="4" id="korean-language" oninput="setSubject()">
            <label class="language-label" for="korean-language">朝鮮語</label>
            <input type="radio" name="language" value="5" id="russian-language" oninput="setSubject()">
            <label class="language-label" for="russian-language">ロシア語</label>
        </div>
        <div class="gakumon-radio-group">
            <input type="radio" name="gakumon" value="0" id="A-gakumon" oninput="setSubject()">
            <label class="gakumon-label" for="A-gakumon">学問A</label>
            <input type="radio" name="gakumon" value="1" id="B-gakumon" oninput="setSubject()">
            <label class="gakumon-label" for="B-gakumon">学問B</label>
            <input type="radio" name="gakumon" value="2" id="C-gakumon" oninput="setSubject()">
            <label class="gakumon-label" for="C-gakumon">学問C</label>
            <input type="radio" name="gakumon" value="3" id="D-gakumon" oninput="setSubject()">
            <label class="gakumon-label" for="D-gakumon">学問D</label>
            <input type="radio" name="gakumon" value="4" id="E-gakumon" oninput="setSubject()">
            <label class="gakumon-label" for="E-gakumon">学問E</label>
        </div>
    </div>
    <div class="spring_inputs_div">
        <div class="spring-inputs-inner">
            <p>これまでのGPA</p>
            <input type="number" id="springGpaInput" oninput="calculate()">
             
        </div>
        <div class="spring-inputs-inner">
            <p>これまでの履修単位数</p>  
            <input type="number" id="springTotalDegreeInput" oninput="calculate()">
        </div>
    </div>
    <div id="autumn_subject">
    </div>

    <div class="autumn_degree_count_preview"><p>秋学期の予定取得単位数: <span id="autumn_degree_count_text">-</span></p></div>

    <button onclick="addSubjectInput()" class="add-subject-button">+ 科目を追加</button>

    <div class="result-div">
        <!-- <button onclick="calculate()">計算</button> -->
        <p>GPA: <span id="result">-</span></p>
    </div>

    <script>

        // window.onload = function () {
        //     document.getElementById('autumn_degree_count_text').textContent = autumnTotalDegree;
        // };

    
        function getSubjectCount() {
            // 現在の科目数を取得
            const subjectInputs = document.getElementById('autumn_subject');
            return subjectInputs.children.length;
        }

        function setSubject() {
            const subjectInputs = document.getElementById('autumn_subject');
            while (subjectInputs.firstChild) {
                subjectInputs.removeChild(subjectInputs.firstChild);
            };

            let selectedLanguageIndex = 0;
            if (document.querySelector(`input[name="language"]:checked`)){
                selectedLanguageIndex = document.querySelector(`input[name="language"]:checked`).value;
            }

            console.log(selectedLanguageIndex);
            const languageList=["第二外国語", "中国語", "フランス語", "ドイツ語", "朝鮮語", "ロシア語"];

            const defaultSubjects = [
                [`${languageList[selectedLanguageIndex]} 1`, `${languageList[selectedLanguageIndex]} 2`, `${languageList[selectedLanguageIndex]} 3`, `${languageList[selectedLanguageIndex]} 4`, "英語 2", "物理学 C", "物理学 D" , "化学 B", "数学 1B", "数学 2B"],
                [`${languageList[selectedLanguageIndex]} 1`, `${languageList[selectedLanguageIndex]} 2`, `${languageList[selectedLanguageIndex]} 3`, `${languageList[selectedLanguageIndex]} 4`, "英語 2", "物理学 C", "物理学 D" , "化学 B", "数学 1B", "数学 2B"],
                [`${languageList[selectedLanguageIndex]} 1`, `${languageList[selectedLanguageIndex]} 2`, `${languageList[selectedLanguageIndex]} 3`, `${languageList[selectedLanguageIndex]} 4`, "英語 2", "物理学 C", "物理学 D" , "化学 B", "数学 2B", "数学 3B"],
                [`${languageList[selectedLanguageIndex]} 1`, `${languageList[selectedLanguageIndex]} 2`, `${languageList[selectedLanguageIndex]} 3`, `${languageList[selectedLanguageIndex]} 4`, "英語 2", "物理学 C", "物理学 D" , "化学 B", "数学 1B", "数学 2B"],
                [`${languageList[selectedLanguageIndex]} 1`, `${languageList[selectedLanguageIndex]} 2`, `${languageList[selectedLanguageIndex]} 3`, `${languageList[selectedLanguageIndex]} 4`, "英語 2", "物理学 C", "物理学 D" , "化学 C", "化学 D", "数学 1B"],
            ];

            if(document.querySelector(`input[name="gakumon"]:checked`)){
                const gakumonIndex = document.querySelector(`input[name="gakumon"]:checked`).value;
                for (let i = 0; i < defaultSubjects[gakumonIndex].length; i++) {
                    addSubjectInput(defaultSubjects[gakumonIndex][i]);
                }
            };
        }

        let subjectIndex = 0;
        let subjectIndexList = [];


        function addSubjectInput(subjectName="") {
            subjectIndex += 1;
            subjectIndexList[subjectIndexList.length] = subjectIndex;

            const subjectInputs = document.getElementById('autumn_subject');
            const newSubjectDiv = document.createElement('div');

            newSubjectDiv.className = `subject-input-${subjectIndex} subject-div`;
            newSubjectDiv.innerHTML = `
                <button onclick="removeSubjectDiv(${subjectIndex})" class="remove-subject-button">&times;</button>
                <div class="subject-inner-div">
                    <p>科目名</p>
                    <input type="text" value="${subjectName}" placeholder="ここに入力" list="subjects" class="subject-name-input">
                    <datalist id="subjects">
                        <option value="数学 1B"></option>
                        <option value="数学 2B"></option>
                        <option value="数学 3B"></option>
                        <option value="物理学 C"></option>
                        <option value="物理学 D"></option>
                        <option value="化学 B"></option>
                        <option value="化学 C"></option>
                        <option value="化学 D"></option>
                        <option value="理工学概論"></option>
                        <option value="生物学序論"></option>
                        <option value="自然科学実験"></option>
                        <option value="英語リスニング"></option>
                        <option value="英語スピーキング"></option>
                        <option value="総合教育セミナー"></option>
                        <option value="経済学"></option>
                        <option value="論理学"></option>
                        <option value="倫理学"></option>
                        <option value="心理学"></option>
                        <option value="法学"></option>
                    </datalist>
                </div>
                <div class="subject-inner-div">
                    <p>評価</p>
                    <div class="subject-radio-group">
                        <input type="radio" name="subject-${subjectIndex}" value="4" id="S-${subjectIndex}" oninput="calculate()">
                        <label class="subject-label" for="S-${subjectIndex}">S</label>

                        <input type="radio" name="subject-${subjectIndex}" value="3" id="A-${subjectIndex}" oninput="calculate()">
                        <label class="subject-label" for="A-${subjectIndex}">A</label>

                        <input type="radio" name="subject-${subjectIndex}" value="2" id="B-${subjectIndex}" oninput="calculate()">
                        <label class="subject-label" for="B-${subjectIndex}">B</label>

                        <input type="radio" name="subject-${subjectIndex}" value="1" id="C-${subjectIndex}" oninput="calculate()">
                        <label class="subject-label" for="C-${subjectIndex}">C</label>

                        <input type="radio" name="subject-${subjectIndex}" value="0" id="D-${subjectIndex}" oninput="calculate()">
                        <label class="subject-label" for="D-${subjectIndex}">D</label>
                    </div>
                </div>
                <div class="subject-inner-div">
                    <p>単位数</p>
                    <div class="degree-radio-group">
                        <input type="radio" name="degree-count-${subjectIndex}" value="1" id="1-${subjectIndex}" oninput="calculate()">
                        <label class="degree-count-label" for="1-${subjectIndex}">1</label>
        
                        <input type="radio" name="degree-count-${subjectIndex}" value="2" id="2-${subjectIndex}" oninput="calculate()" checked> 
                        <label class="degree-count-label" for="2-${subjectIndex}">2</label>
                    </div>
                </div>`;
            subjectInputs.appendChild(newSubjectDiv);
            requestAnimationFrame(() => {
                newSubjectDiv.classList.add('added');
                calculate();
            });

        }

        function removeSubjectDiv(subjectIndex) {
            const subjectInputs = document.getElementById('autumn_subject');

            let index = subjectIndexList.indexOf(subjectIndex);
            if (index !== -1) {
                subjectIndexList.splice(index, 1);
            }

            const subjectDiv = document.querySelector(`.subject-input-${subjectIndex}`);
            if (subjectDiv) {
                subjectDiv.classList.add('removing');
                subjectDiv.addEventListener('transitionend', () => {
                    subjectInputs.removeChild(subjectDiv);
                    calculate();
                }, { once: true });
            }
        }

        function truncateToTwoDecimals(number) {
            return Math.floor(number * 100) / 100;
        }

        function calculate() {
            const springGPA = document.getElementById('springGpaInput').value;
            const springTotalDegree = document.getElementById('springTotalDegreeInput').value;
            const springGradesTotal = springGPA * springTotalDegree;

            let autumnGradesTotal = 0;
            let autumnTotalDegree = 0;

            subjectIndexList.forEach(i => {
                const gradeValue = document.querySelector(`input[name="subject-${i}"]:checked`);
                const degreeCount = document.querySelector(`input[name="degree-count-${i}"]:checked`);
                if (gradeValue && degreeCount) {
                    autumnGradesTotal = parseFloat(autumnGradesTotal) + parseFloat(gradeValue.value, 10) * parseFloat(degreeCount.value, 10); 
                    autumnTotalDegree = parseFloat(autumnTotalDegree) + parseFloat(degreeCount.value, 10); 
                }
            });

            const gradesTotal = parseFloat(springGradesTotal) + parseFloat(autumnGradesTotal);
            const totalDegree = parseFloat(springTotalDegree) + parseFloat(autumnTotalDegree);

            let totalGPA = gradesTotal / totalDegree;
            if (isNaN(totalGPA) || !isFinite(totalGPA)) {
                totalGPA = "-";
            } else {
                totalGPA = truncateToTwoDecimals(totalGPA);
            }
            
            document.getElementById('autumn_degree_count_text').textContent = autumnTotalDegree;
            document.getElementById('result').textContent = totalGPA;
        }

        
    </script>

<p class="warning">
    本サイトでは、入力情報の取得はいたしません。<br>
    また、計算結果に関して誤りが生じる場合がございます。<br>
    自己責任でお使いください</p>
</body>
<footer><br>&copy; 2024 Ryu Ishizaki</footer>
</html>